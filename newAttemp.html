<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Bubble Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        #chart {
            border: 1px solid #ddd;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <div>
            <label for="x-axis">X-Axis:</label>
            <select id="x-axis">
                <option value="revenue">Revenue</option>
                <option value="marketCap">Market Cap</option>
            </select>
        </div>
        <div>
            <label for="y-axis">Y-Axis:</label>
            <select id="y-axis">
                <option value="sales">Sales</option>
                <option value="profit">Profit</option>
            </select>
        </div>
    </div>
    <svg id="chart" width="800" height="600"></svg>

    <script>
        // Sample dataset
        const data = [
            { 
                name: "Apple", 
                revenue: 365800,
                marketCap: 2870000,
                sales: 394300,
                profit: 99800,
                size: 50 
            },
            { 
                name: "Google", 
                revenue: 282800,
                marketCap: 1630000,
                sales: 282800,
                profit: 60400,
                size: 45 
            },
            { 
                name: "Microsoft", 
                revenue: 267100,
                marketCap: 2030000,
                sales: 267100,
                profit: 72700,
                size: 40 
            },
            { 
                name: "Amazon", 
                revenue: 469800,
                marketCap: 1370000,
                sales: 386100,
                profit: 33400,
                size: 55 
            },
            { 
                name: "Meta", 
                revenue: 116600,
                marketCap: 790000,
                sales: 116600,
                profit: 23200,
                size: 35 
            }
        ];

        class BubbleChart {
            constructor(svgId, data) {
                this.svg = document.getElementById(svgId);
                this.data = data;
                this.margin = { top: 50, right: 50, bottom: 50, left: 100 };
                this.width = 800;
                this.height = 600;

                this.xSelect = document.getElementById('x-axis');
                this.ySelect = document.getElementById('y-axis');

                this.xSelect.addEventListener('change', () => this.updateChart());
                this.ySelect.addEventListener('change', () => this.updateChart());

                this.colors = [
                    '#1f77b4', '#ff7f0e', '#2ca02c', 
                    '#d62728', '#9467bd', '#8c564b'
                ];

                this.updateChart();
            }

            updateChart() {
                // Clear previous chart
                while (this.svg.firstChild) {
                    this.svg.removeChild(this.svg.firstChild);
                }

                const xKey = `${this.xSelect.value}`;
                const yKey = `${this.ySelect.value}`;

                // Determine scales
                const xValues = this.data.map(d => d[xKey]);
                const yValues = this.data.map(d => d[yKey]);
                const sizeValues = this.data.map(d => d.size);

                const xScale = this.createScale(xValues, 
                    this.margin.left, this.width - this.margin.right);
                const yScale = this.createScale(yValues.reverse(), 
                    this.height - this.margin.bottom, this.margin.top);
                const sizeScale = this.createSizeScale(sizeValues);

                // Create bubbles
                this.data.forEach((d, i) => {
                    const bubble = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    
                    bubble.setAttribute('cx', xScale(d[xKey]));
                    bubble.setAttribute('cy', yScale(d[yKey]));
                    bubble.setAttribute('r', sizeScale(d.size));
                    bubble.setAttribute('fill', this.colors[i % this.colors.length]);
                    bubble.setAttribute('opacity', '0.7');

                    // Add tooltip
                    const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
                    title.textContent = `${d.name}\nX: ${d[xKey]}\nY: ${d[yKey]}`;
                    bubble.appendChild(title);

                    this.svg.appendChild(bubble);

                    // Add labels
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute('x', xScale(d[xKey]));
                    text.setAttribute('y', yScale(d[yKey]));
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dy', '4');
                    text.setAttribute('font-size', '10');
                    text.textContent = d.name;
                    this.svg.appendChild(text);
                });

                // X-axis
                this.createAxis(
                    xScale, 
                    this.width, 
                    this.height - this.margin.bottom, 
                    'horizontal',
                    this.xSelect.options[this.xSelect.selectedIndex].text
                );

                // Y-axis
                this.createAxis(
                    yScale, 
                    this.margin.left, 
                    0, 
                    'vertical',
                    this.ySelect.options[this.ySelect.selectedIndex].text
                );
            }

            createScale(values, rangeStart, rangeEnd) {
                const min = Math.min(...values);
                const max = Math.max(...values);
                
                return value => {
                    return rangeStart + 
                        ((value - min) / (max - min)) * (rangeEnd - rangeStart);
                };
            }

            createSizeScale(values) {
                const min = Math.min(...values);
                const max = Math.max(...values);
                
                return value => {
                    return 10 + ((value - min) / (max - min)) * 40;
                };
            }

            createAxis(scale, x, y, orientation, label) {
                const axisGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
                
                // Create 5 ticks
                for (let i = 0; i <= 4; i++) {
                    const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    
                    if (orientation === 'horizontal') {
                        const tickX = scale(i * (Math.max(...this.data.map(d => d[this.xSelect.value])) / 4));
                        tick.setAttribute('x1', tickX);
                        tick.setAttribute('y1', y);
                        tick.setAttribute('x2', tickX);
                        tick.setAttribute('y2', y + 10);
                        
                        text.setAttribute('x', tickX);
                        text.setAttribute('y', y + 20);
                        text.setAttribute('text-anchor', 'middle');
                    } else {
                        const tickY = scale(i * (Math.max(...this.data.map(d => d[this.ySelect.value])) / 4));
                        tick.setAttribute('x1', x - 10);
                        tick.setAttribute('y1', tickY);
                        tick.setAttribute('x2', x);
                        tick.setAttribute('y2', tickY);
                        
                        text.setAttribute('x', x - 15);
                        text.setAttribute('y', tickY);
                        text.setAttribute('text-anchor', 'end');
                        text.setAttribute('alignment-baseline', 'middle');
                    }
                    
                    tick.setAttribute('stroke', 'black');
                    text.setAttribute('font-size', '10');
                    text.textContent = (i * (Math.max(...this.data.map(d => d[orientation === 'horizontal' ? this.xSelect.value : this.ySelect.value])) / 4)).toFixed(0);
                    
                    this.svg.appendChild(tick);
                    this.svg.appendChild(text);
                }

                // Axis label
                const axisLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
                if (orientation === 'horizontal') {
                    axisLabel.setAttribute('x', this.width / 2);
                    axisLabel.setAttribute('y', this.height - 10);
                    axisLabel.setAttribute('text-anchor', 'middle');
                } else {
                    axisLabel.setAttribute('transform', 'rotate(-90)');
                    axisLabel.setAttribute('x', -this.height / 2);
                    axisLabel.setAttribute('y', 20);
                    axisLabel.setAttribute('text-anchor', 'middle');
                }
                axisLabel.textContent = label;
                this.svg.appendChild(axisLabel);
            }
        }

        // Initialize the chart
        const bubbleChart = new BubbleChart('chart', data);
    </script>
</body>
</html>