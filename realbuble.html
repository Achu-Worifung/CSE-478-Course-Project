<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <script src="https://d3js.org/d3.v6.js"></script>

    </head>
    <body>
        <div class="controls">
            <div>
                <label for="x-axis">year:</label>
                <select id='year'>
                    <option value="2021">2021</option>
                    <option value="2020">2020</option>
                    <option value="2019">2019</option>
                </select>
            </div>

            <div>
                <label for="y-axis">Y-Axis:</label>
                <select id="y-axis">
                    <option value="Log GDP per capita">Log GDP per
                        capita</option>
                    <option value="Social support">Social support</option>
                </select>
            </div>
        </div>
        <svg id="chart" width="1000" height="900"></svg>
        <svg id="radial_chart" width="1000" height="900"></svg>

        <script>
            const margin = { top: 10, right: 20, bottom: 30, left: 50 },
                width = 900 - margin.left - margin.right,
                height = 700 - margin.top - margin.bottom;
        
            const svg = d3.select("#chart")
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
        
            // Create a tooltip div
            const tooltip = d3.select("body")
                .append("div")
                .style("position", "absolute")
                .style("visibility", "hidden")
                .style("background", "#f9f9f9")
                .style("border", "1px solid #ccc")
                .style("padding", "8px")
                .style("border-radius", "4px")
                .style("font-size", "12px")
                .style("pointer-events", "none");
        
            d3.csv('./datasets/world-happiness-report-2005-2021.csv').then(function (data) {
                const yearSelect = document.getElementById('year');
                const yAxisSelect = document.getElementById('y-axis');
        
                function updateChart() {
                    const selectedYear = yearSelect.value;
                    const yVariable = yAxisSelect.value;
                    drawData(data, selectedYear, yVariable);
                }
        
                yearSelect.addEventListener('change', updateChart);
                yAxisSelect.addEventListener('change', updateChart);
        
                updateChart(); // Initial rendering
            });
        
            function drawData(data, year, yVariable) {
                svg.selectAll("*").remove();
        
                data = data.filter(d => d.year == year);
        
                const x = d3.scaleLinear().domain([0, 10]).range([0, width]);
                svg.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(x));
        
                const y = d3.scaleLinear()
                    .domain([d3.min(data, d => +d[yVariable]) * 0.99, d3.max(data, d => +d[yVariable]) * 1.01])
                    .range([height, 0]);
                svg.append("g").call(d3.axisLeft(y));
        
                const z = d3.scaleLinear().domain(d3.extent(data, d => +d[yVariable])).range([2, 10]);
        
                svg.append("g")
                    .selectAll("circle")
                    .data(data)
                    .join("circle")
                    .attr("cx", d => x(d['Ladder score']))
                    .attr("cy", d => y(d[yVariable]))
                    .attr("r", d => z(d[yVariable]))
                    .style("fill", d => d.color || "#69b3a2")
                    .style("opacity", 0.7)
                    .on("mouseover", function (event, d) {
    tooltip.style("visibility", "visible")
        .html(`<strong>${d['Country name']}</strong><br>${yVariable}: ${d[yVariable]}`);
    d3.select(this).style("stroke", "black").style("stroke-width", 2);
})
.on("mousemove", function (event) {
    tooltip.style("top", `${event.pageY + 10}px`)
        .style("left", `${event.pageX + 10}px`);
})
.on("mouseout", function () {
    tooltip.style("visibility", "hidden");
    d3.select(this).style("stroke", "none");
})
.on("click", function (event, d) {
    const maxValues = {
        "Log GDP per capita": d3.max(data, d => +d['Log GDP per capita']),
        "Social support": d3.max(data, d => +d['Social support']),
        "Healthy life expectancy": d3.max(data, d => +d['Healthy life expectancy at birth']),
        "Freedom to make life choices": d3.max(data, d => +d['Freedom to make life choices']),
        "Generosity": d3.max(data, d => +d['Generosity']),
        "Perceptions of corruption": d3.max(data, d => +d['Perceptions of corruption']),
        "Ladder score": d3.max(data, d => +d['Ladder score'])
    }
    drawRadialChart(d, maxValues);

            });
            }


            function drawRadialChart(data,maxValues)  {
                console.log(data);
                console.log(maxValues);
                
                
            }
        </script>

    </body>
</html>